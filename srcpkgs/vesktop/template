# Template file for 'vesktop'
pkgname=vesktop
version=1.6.1
revision=1
archs="x86_64"
wrksrc="Vesktop-${version}"
hostmakedepends="nodejs pnpm"
depends="alsa-lib gtk+3 nss"
short_desc="A standalone Electron-based Discord app with Vencord & improved Linux support"
maintainer="Vanilla <SnowyDaFur@protonmail.com>"
license="AGPL-3.0-only"
homepage="https://github.com/Vencord/Vesktop"
distfiles="https://github.com/Vencord/Vesktop/archive/refs/tags/v${version}.tar.gz"
checksum="ba103cf8a9edef31eb78c1bc3d76e40151f84ff02b2da8fd2bc21a954841b523"

if [ "$XBPS_TARGET_LIBC" = "musl" ]; then
  broken="This package does not support musl build."
fi

do_build() {
  export NODE_ENV=production

  pnpm install
  pnpm build
  pnpm exec electron-builder --dir
}

do_install() {
	# Main files
  vmkdir usr/lib/vesktop
  cp -r dist/linux-unpacked/* ${DESTDIR}/usr/lib/vesktop/

	# Icon
	vinstall build/icon.svg 644 usr/share/icons/hicolor/scalable/apps/vesktop.svg

	# Desktop file
	vinstall "$FILESDIR/vesktop.desktop" 644 usr/share/applications

	# Linking binary
	vmkdir usr/bin
  ln -sf /usr/lib/vesktop/vesktop ${DESTDIR}/usr/bin/vesktop
}
